{% load static %}

<div class="profile-page">
  <div class="background-image">
    <div class="container py-5">
      <div class="row justify-content-center g-4">
        <!-- Profile Section -->
        <div class="col-lg-4">
          <div class="content profile-card p-4">
            <div class="text-center mb-4 profile_info_container">
              <div class="profile-pic-container position-relative d-inline-block">
                {% if player.profile_picture %}
                  <img src="{{ player.profile_picture }}" alt="Profile Picture" class="profile-pic rounded-circle" />
                {% else %}
                  <img src="{% static 'images/default_profile_pic.jpeg' %}" alt="Default Profile Picture" class="profile-pic rounded-circle" />
                {% endif %}
                {% if is_self %}
                  <button id="change-profile-pic" class="btn btn-light btn-sm position-absolute bottom-0 end-0" onclick="updateProfilePic()"><i class="fa-solid fa-pen"></i></button>
                {% else %}
                  {% if player.is_logged_in %}
                    <i class="fa-solid fa-globe position-absolute globe-icon" style="color:green;"></i>
                  {% else %}
                    <i class="fa-solid fa-globe position-absolute globe-icon" style="color:red;"></i>
                  {% endif %}
                {% endif %}
              </div>

              <div id="pfp_from_profile" class="profile-info mt-3" data-pfp="{{ player.profile_picture }}">
                <h3 id="full_name" class="mb-1 nav_profile_pic">{{ player.full_name }}</h3>
                <p id="username" class="text-muted mb-1" data-username="{{ player.username }}">@{{ player.username }}</p>
                <p class="text-muted small mb-3">
                  <i class="fas fa-envelope me-2"></i><span id="player_email">{{ player.email }}</span>
                </p>
              </div>

              <div class="d-flex justify-content-center gap-4 mb-3">
                <div class="text-center">
                  <h5 id="nums_of_friends" class="mb-1">{{ num_of_friends|default:0 }}</h5>
                  <small class="text-muted">Friends</small>
                </div>
                <div class="text-center">
                  <h5 class="mb-1">{{ player.rating|default:0 }}</h5>
                  <small class="text-muted">Points</small>
                </div>
              </div>
              {% if player.is_guest %}
                <h6>temp account</h6>
              {% elif is_self %}
                <button type="button" id="update-user-info" class="btn btn-primary mb-2" onclick="updateProfileInfo()"><i class="fas fa-edit me-2"></i>Update Info</button>
                <a onclick="appRouter()" href="/settings" id="profile-settings" class="btn btn-secondary mb-2"><i class="fas fa-cog me-2"></i>Settings</a>
              {% else %}
                {% if is_friend %}
                  <button onclick="removeFriend()" id="unfriend_btn" type="button" class="btn btn-danger friendship_btn"><i class="fas fa-user-minus me-2"></i>Unfriend</button>
                  <button onclick="create_chatroom('{{ player.username }}')" id="chat_btn" type="button" class="btn btn-secondary chat_btn friendship_btn"><i class="fas fa-comment-alt me-2"></i> chat</button>
                {% elif is_requested_by_me %}
                  <button onclick="cancelFriendRequest()" id="cancel_request_btn" type="button" class="btn btn-danger friendship_btn"><i class="fas fa-user-times me-2"></i>Cancel Request</button>
                {% elif am_i_requested %}
                  <button onclick="acceptOrDeclineFriendRequest(`accept`, `{{ player.username }}`)" id="accept_request_btn" type="button" class="btn btn-success friendship_btn me-1 mb-2"><i class="fas fa-check me-2"></i>Accept</button>
                  <button onclick="acceptOrDeclineFriendRequest(`decline`, `{{ player.username }}`)" id="decline_request_btn" type="button" class="btn btn-danger friendship_btn mb-2"><i class="fas fa-times me-2"></i>Decline</button>
                {% else %}
                  <button onclick="addFriendRequest()" id="add_friend_btn" type="button" class="btn btn-primary friendship_btn"><i class="fas fa-user-plus me-2"></i>Send Request</button>
                {% endif %}
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Game History Section -->
        <div class="col-lg-8">
          <div class="content game-history-card" style="height: 100%;">
            <h3 class="text-center mb-4">Game History</h3>
            {% if games %}
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <div>
                        <th>Match</th>
                        <th>Result</th>
                        <th>Score</th>
                        <th>Points</th>
                        <th>Date</th>
                        <th>Type</th>
                      </div>
                    </tr>
                  </thead>
                  <tbody>
                    {% for game in games %}
                      <tr>
                        <td>
                          <div>
                            <span class="player-name">VS {{ game.player_two }}</span>
                          </div>
                        </td>
                        <td>
                          <div class="results">
                            {% if game.outcome == 'WIN' %}
                              <span class="text-success">Win</span>
                            {% elif game.outcome == 'LOSE' %}
                              <span class="text-danger">Lose</span>
                            {% else %}
                              <span class="text-warning">Cancelled</span>
                            {% endif %}
                          </div>
                        </td>
                        <td>
                          <div>
                            <span class="score-res">{{ game.final_score }}</span>
                          </div>
                        </td>
                        <td>
                          <div>
                            <span class="points-badge">+5</span>
                          </div>
                        </td>
                        <td>
                          <div>
                            <span class="date">{{ game.start_time }}</span>
                            <!-- <span class="date">11/11/2025 19:55</span> -->
                          </div>
                        </td>
                        <td>
                          <div>
                            <span class="game-type">{{ game.type }}</span>
                          </div>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              <!-- Pagination -->
              <div class="pagination-size d-flex justify-content-center gap-2 mt-4">
                <button id="prev-page" class="btn btn-outline-light btn-sm" disabled><i class="fas fa-chevron-left"></i></button>
                <span id="page-numbers" class="d-flex gap-2">
                  <button class="btn btn-primary btn-sm">1</button>
                  <button class="btn btn-outline-light btn-sm">2</button>
                  <button class="btn btn-outline-light btn-sm">3</button>
                </span>
                <button id="next-page" class="btn btn-outline-light btn-sm"><i class="fas fa-chevron-right"></i></button>
              </div>
            {% else %}
              <div class="text-center no-games-message d-flex flex-column">
                <div class="d-flex flex-column align-items-center text-center px-3">
                  <i class="fas fa-gamepad mb-3" style="font-size: 2rem; color: #6c757d;"></i>
                  <p class="fw-bold mb-2 text-wrap" style="font-size: 1.5rem; color: #6c757d;">You have not played any games yet.</p>
                  <p class="text-wrap" style="font-size: 1rem; color: #6c757d;">Play games to see your history here!</p>
                </div>
              </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- new div for game stats with a pie chart and line graph in it side by side -->
      {% if num_of_games > 0 %}
        <div class="row justify-content-center g-4 mt-2 stats-container">
          <div class="col-lg-4">
            <div id="win_lose_stats" class="content game-stats-card p-4" data-numsOfGames="{{ num_of_games }}" data-numsOfWins="{{ games_won }}" data-numsOfLoses="{{ games_lost }}">
              <h3 class="text-center mb-4">Win-Loss Stats</h3>
              <div class="d-flex justify-content-center">
                <canvas id="game-stats-pie-chart"></canvas>
              </div>
            </div>
          </div>
          <div class="col-lg-8">
            <div class="content game-stats-card p-4">
              <h3 class="text-center mb-4">Leaderboard Ranking</h3>
              <div class="d-flex justify-content-center">
                <canvas id="game-stats-line-chart"></canvas>
              </div>
            </div>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</div>
